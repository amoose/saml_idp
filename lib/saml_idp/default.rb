# encoding: utf-8
require 'saml_idp'

module SamlIdp
  # TODO(awong): Move this to a better location.
  def self.fingerprint_cert(cert_pem)
    return nil unless cert_pem
    cert = OpenSSL::X509::Certificate.new(cert_pem)
    OpenSSL::Digest::SHA256.new(cert.to_der).hexdigest
  end

  # Default configuration parameters for the identity provider.
  # There's almost no circumstance that you want want to use the default
  # cert.
  module Default
    NAME_ID_FORMAT = "urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"
    X509_CERTIFICATE = <<EOC
-----BEGIN CERTIFICATE-----
MIIDXDCCAkQCCQC51/Vezu6XQTANBgkqhkiG9w0BAQsFADBwMQswCQYDVQQGEwJV
UzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHU2VhdHRsZTERMA8GA1UE
ChMISDhYTUxTZWMxCzAJBgNVBAsTAkg4MRowGAYDVQQDExFodHRwczovL2xvY2Fs
aG9zdDAeFw0xNDExMDUyMTA1MzhaFw0yNDExMDIyMTA1MzhaMHAxCzAJBgNVBAYT
AlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdTZWF0dGxlMREwDwYD
VQQKEwhIOFhNTFNlYzELMAkGA1UECxMCSDgxGjAYBgNVBAMTEWh0dHBzOi8vbG9j
YWxob3N0MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzH95S1WHsk6u
hdNK04iMEjdXSL2Dw0YipB25mx3DlMgtRjk/PMJ5ZFJkuU26bVzpWyRO9AvaYj48
u3tnWaGfrZV/CQ8rwkUbntChglxFlOtqDAtN+KGuKOSM9e6dAGqtqq0sTNyYwXtE
8Ho3ZtxlUTw1GNCT/SI5qtDr1ON172awWFYacN137EGDBkCgDMKXdqUFuDfB7cnR
kbvJUzvu+NQjkdYmCTArbH+akMEh2Ln+i9j6VmsS7aNgX5GYpN8ir+NjxN6QYc9K
wJRYBHSsJb5DZqrdOprAXk1J11fWrzBA1tudv2QOwkAj/Nl61SNlOmUo1RFEVWDi
q9xI9lT50QIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQA8/E+Nv30/AwtfKVh/Eym0
TtEcHcq9cetD5gVRXFK/MCoccKonpsmkR/cxwEwsgApb5ycCq0xthkhVnzhFq22J
2kPlWHBryAJSSqlnmSavJNzwRwu+sIas/ctwSD4hyqOzdb9MVe2rNOANXL3ICBDT
q8YGGmLjYJYLG/iH/3V5jTakW+CrxWwzQOyYAT3pnWkT9oO/7JoL7BPgtsCgcbSy
voouaKe1wvNWe2bdLO/W5Lh4rtFMUC4r5dBhRhT7qkLw2ZTP7YhTE0jA6ITQy1Nf
xeMf79IFVRcxhn+2JTdZhkPdUjaeQLZ/8aU9IkPL2Kj6wckqMKKepa7oH20XBOjN
-----END CERTIFICATE-----
EOC
    IDP_FINGERPRINT = SamlIdp::fingerprint_cert(X509_CERTIFICATE)

    SECRET_KEY = <<EOS
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAzH95S1WHsk6uhdNK04iMEjdXSL2Dw0YipB25mx3DlMgtRjk/
PMJ5ZFJkuU26bVzpWyRO9AvaYj48u3tnWaGfrZV/CQ8rwkUbntChglxFlOtqDAtN
+KGuKOSM9e6dAGqtqq0sTNyYwXtE8Ho3ZtxlUTw1GNCT/SI5qtDr1ON172awWFYa
cN137EGDBkCgDMKXdqUFuDfB7cnRkbvJUzvu+NQjkdYmCTArbH+akMEh2Ln+i9j6
VmsS7aNgX5GYpN8ir+NjxN6QYc9KwJRYBHSsJb5DZqrdOprAXk1J11fWrzBA1tud
v2QOwkAj/Nl61SNlOmUo1RFEVWDiq9xI9lT50QIDAQABAoIBACl8JrAYrsmGWrM9
VO2qwrejUGqqP4Oqw7ZFbXTBSf7xyPV5AZIi5Ztrd5F76jjrY0+hAv9RNEE/3PQv
qZyuRAVj0XyV/kuP13WVX15ht5/pTf8Zf/zTV9Bl5Q6zFFiUS5zXOqhxC/AcQLUE
Jh8Q0OD09NSO46azfb1gWqc6aZ9h+bqDu+F+qArcARTKg9aiu0RzZB/I6W7N6Fff
POE2HQsW2R8gRwxf8JG3EKsHzP7qwElr8oxUykWmpnMwuJ4T00DaaH/rxg8TZv6a
ErcMef/V/rjx+gfR6KJauegcZmf762lJ+mU1nBSBqNTc1FdnGsf9HiYZySMoIzgC
nZ+W0l0CgYEA7O3Stpfkaa+mOBuAUkHl1+nuWIN90fWgmMTUFu4YK79DxLZjmucb
P2aCE2TR/AtBBfn2dB+8ikj1zVPzt+Ek9kh1bkqvxwoiob/GIVprPCwJrFHotjfc
+/2fmRRq/AwDAPiNZVz1dPDbgst+SdMEcYjgdCbO3lYzwf6E454L6PcCgYEA3PVf
vaGB0OrxmKeigPN1+/gvL0+gF63s0KIW1rime3m5kqyDslf/OOW+ofQ4KdoIK03t
na42aD9M0HQrhiwGZigzkeHZLXQ4pTDE8hMDbcY3ejL+v90ZJPAuhebyMnQmHg1M
5dBcXEaMNlDEqxofrhpO2IyaLdR7Wt0sxYV9CXcCgYEAnsLiHn57jSIpRJGRFA2a
QWs8zk0WI3nvKk9COzdCNRZOB+ObrPHNvVcoNGyrlLPJ14Je1gNqKFOpefQWbRHN
3cZCAizDyqENAcvqrPDUyJZNyQ193ZRjXOvfZQlcgxZdcOocfV6kD79RqDxJnJhs
8tMgbFSQ7EVhG048p/WAz5MCgYAkWgIcUpvm4SBKOxoTGPrKL3Sj1ffCrYyObnxP
ayWInugW52brSmrk03dfcaxjxkkdxr5W+LhewjtC+DnI4ylSWT7Su1NdlQdUtgdQ
xCwGPVwXMJiUvC1M1G7y/KHQByfWPd3u2S64x6p9rSAN/khD/nQGUGt1KsX4lvas
sF931QKBgQDP730LUBRBDKzNrADXwrTJxcJwNcbfn+YKX1Nn430i2wJKsmhJS2Ub
ugcXIUWHqARfG4OEvyLMWD75uXqsft3Oki+mtT0onnq9KvGk4YHEMimOTOTam2oA
dKJs4sa2VhJMAHV8qhKtKVlS7YkXixV1ISccFQBHPXZUy5+25wYR0A==
-----END RSA PRIVATE KEY-----
EOS

    SERVICE_PROVIDER_CERT = <<EOC
-----BEGIN CERTIFICATE-----
MIIDTDCCAjQCCQDfFz0u755itjANBgkqhkiG9w0BAQsFADBoMQswCQYDVQQGEwJV
UzETMBEGA1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHU2VhdHRsZTEXMBUGA1UE
ChMOU2FtbCBNZSBIYXJkZXIxGTAXBgNVBAMTEGh0dHA6Ly9sb2NhbGhvc3QwHhcN
MTQxMDA4MTk1MzA2WhcNMjQxMDA1MTk1MzA2WjBoMQswCQYDVQQGEwJVUzETMBEG
A1UECBMKV2FzaGluZ3RvbjEQMA4GA1UEBxMHU2VhdHRsZTEXMBUGA1UEChMOU2Ft
bCBNZSBIYXJkZXIxGTAXBgNVBAMTEGh0dHA6Ly9sb2NhbGhvc3QwggEiMA0GCSqG
SIb3DQEBAQUAA4IBDwAwggEKAoIBAQDQGhgK1htT/+DeWp6t5+wIII49Z6YjHkXT
QizJkxUThy+JDelueyUAfWQmrmjGVDT2JUDVw3Hcd/0n4+6DK/ry4GA0mbnE94Pc
z6LoFjLZM11xJedq3wOINjp7RwvRWYEU2VVSQt2RAIIEDu+jCbvxyyvNuqdYtp21
wgxJM0YZVAKWALN6H7eJAYJomB+wErdjP5J5CXhH0fjY2Y7J92A/l8JxQlPVwM50
XEx1egnD+8kZE1pJAKNuCSYmPsCJ83t3E+1d9E1o7bXoZmzksCQvtxbRiGbRZZ/h
YbWUSgicLpH2je83ZCHBBuloy9ycrrnX7wMwJKB6QUjk7hTEqy9zAgMBAAEwDQYJ
KoZIhvcNAQELBQADggEBAK9RAyu1AN+3TL+dUqgiA5AjpFy8mcQZePEVJuyEkwWd
r2LLUgQiLE+Vyo9u05MDID34pqd6pgxDQEgT45GAuOANB789GTA7dIdz/nK68UXb
LvOyfCgkFQvGfWWo8uQfQm2+cVsexzyfH2U87SxFkEazY5Er9xp5+Na19LQdBK/Y
N9H8uCPOJ6uBAd2DhoqVXVV/rN27dT/N+/y6m1XsEo0IVPuagfNvy4M/QZu3yF71
CuROpF4iknEcrl/2sNAAU2XSJ7El6InE5TYrC+c2lK1onvHZ7NzkKbrR6jcjkoXO
Mim5TpqlS+BSxqBhDuRoDkDu8V+McCDOso2ZXEviQKw=
-----END CERTIFICATE-----
EOC
    SP_FINGERPRINT = SamlIdp::fingerprint_cert(SERVICE_PROVIDER_CERT)

    SERVICE_PROVIDER_KEY = <<EOS
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA0BoYCtYbU//g3lqerefsCCCOPWemIx5F00IsyZMVE4cviQ3p
bnslAH1kJq5oxlQ09iVA1cNx3Hf9J+Pugyv68uBgNJm5xPeD3M+i6BYy2TNdcSXn
at8DiDY6e0cL0VmBFNlVUkLdkQCCBA7vowm78csrzbqnWLadtcIMSTNGGVQClgCz
eh+3iQGCaJgfsBK3Yz+SeQl4R9H42NmOyfdgP5fCcUJT1cDOdFxMdXoJw/vJGRNa
SQCjbgkmJj7AifN7dxPtXfRNaO216GZs5LAkL7cW0Yhm0WWf4WG1lEoInC6R9o3v
N2QhwQbpaMvcnK651+8DMCSgekFI5O4UxKsvcwIDAQABAoIBAQC5BtplmCTINPQc
/3miqljEiR2vHx8qjloLEgV8XFga+tGbDFGGt9sYamTHt77UyD4mtMzGw3XTTqQ5
+YEyA8KmfDVNz3jK1j/Z7oury0D+uZrVZZwy+4LKc1zgCzVIuEn63ZntACK8MDVp
olYTIi6HN9wEmXb9e7ER0CzYUMx86wjFVYWa7ROJ8JhqaV2cnaGYCi6Kh37ftUJo
CrZvVB6Xi2pQAJcDjH5osX8ExlPgAq34/mWVR2hzsW/78J2sV6aQ3ove8QrzE5fd
8X2gHNKIe+8PH8VeVp2jG22C0i9xMnqerTKL/IdWg3G3nihjxX51psgISPiTNfAF
xM4jiYuBAoGBAOh+F0T3j1+0vheNkwE+or+mBINxrzMQYZIs7EuKZCAsKgEOQxID
diGeXQjsuWgxcD3Dp2SlEaI1hwgLix4tAVYwssrJ8bUMZcEPRi3DmgMrP+m6dyEl
i8AoYxrk/S3gf3AaD2bNlx96OHmRTLI2kRzJdiV+UxZOvi8++5pxHjsTAoGBAOUk
qzfEWwPA8xsGLB92YznjA7D20yACKjHpHwLDP/8wDkMrJ10lvbFomDTA+PfvbTr0
XMYLWTgotdZhoAqoIvFepLOPiKCw0cBriFFmBBiKlVoDAzqXPxH70kXQJ6sD7/YS
ev7IQv/bDUc5nkC8JYd/baNUKmeKdXC1Pbx2VGYhAoGBAIxdLBFQYThH+AhiSiGT
PlD0m378UOlEd5P4GUVWLTMbVtTCVo32lwifAs5TlXCpgHlZuaNS4X2MUZTy2zAB
ve/agOdb2tkSvhA794PDtyU4pGKpWCkj8Oa3u3XOUGi1RFta8HeBoj633IbQyXxC
44N8wh7K0MEEE2CU5vSMXNMPAoGADEW4fdYgYcUVwB7GgjDfA5yq9/FgQVicVev8
YzN92/cA7IwFIbIBxNyrOjgTnYPPP9cSmPDGqIFVq9OytJ9or7C39X38fU67DSk1
NdbW5VGWyilbJOow0I/CJUcOuNQPKAi5Waf0HqvmvCfT1/e7stQaVSMO2ljKDW1H
jy5vOsECgYB0GttgAjRlG/yeJIj1EKROZ2yIRNLLI07eWujq9ipII2tBnGImQXr7
Zzc78SDqEXfCpNWPlcy22o+Zmz12F/VIiCg/ypDSgVf4EpPvQ1WPc+dPZUH7Gw6u
K8r42BP6/nB0U+Wniy1TK2jqGQ7o/F9InuGxyygek1poY2Ru/I9JfA==
-----END RSA PRIVATE KEY-----
EOS

    # TODO(awong): localhost:3000 seems like the wrong default
    SERVICE_PROVIDER = {
      cert: SERVICE_PROVIDER_CERT,
      fingerprint: SP_FINGERPRINT,
      acs_url: 'http://localhost:3000/saml/consume',
      sso_url: 'http://localhost:3000/saml/sso_return',
      block_encryption: 'aes256-cbc',
      key_transport: 'rsa-oaep-mgf1p',
    }
  end
end
